# 第1.2章：Go编译器的阶段

&#x20;       如图1-1所示，在经典的编译原理中，一般将编译器分为编译器前端、优化器和编译器后端。这种编译器被称为三阶段编译器（three-phase compiler）。其中，编译器前端主要专注于理解源程序、扫描解析源程序并进行精准的语义表达。编译器的中间阶段（Intermediate Representation，IR）可能有多个，编译器会使用多个IR阶段、多种数据结构表达代码，并在中间阶段对代码进行多次优化。例如，识别冗余代码、识别内存逃逸等。编译器的中间阶段离不开编译器前端记录的细节。编译器后端专注于生成特定目标机器上的程序，这种程序可能是可执行文件，也可能是需要进一步处理的中间形态obj文件、汇编语言等。

![图1-1 三阶段编译器](<../../.gitbook/assets/image (3).png>)

三阶段编译器架构可以将高级语言与特定的硬件解耦，并且避免各个硬件平台重复性的优化工作。 需要注意的是，编译器优化并不是一个非常明确的概念。优化的主要目的一般是降低程序资源的消耗，比较常见的是降低内存与CPU的使用率。但在很多时候，这些目标之间可能是相互冲突的，对一个目标的优化可能降低另一个目标的效率。同时，理论已经表明有一些代码优化存在着NP难题\[1]，这意味着随着代码的增加，优化的难度将越来越大，需要花费的时间呈指数上升。因为这些原因，编译器无法进行最佳的优化，而通常采用一种折中的方案。 Go编译器一般缩写为小写的gc（go compiler），需要和大写的GC（垃圾回收）进行区分。Go编译器执行流程可细化为多个阶段，包括词法解析、语法解析、抽象语法树构建、类型检查、变量捕获、函数内联、逃逸分析、闭包重写、遍历并编译函数、SSA生成、机器码生成，如图1-2所示。在后面的章节中将对这些阶段逐一分析。

![图1-2 Go 语言编译器执行流程](<../../.gitbook/assets/image (4).png>)
